# APM常见问题<a name="apm_07_0007"></a>

1.  **APM Agent和其他产品Agent（如Pinpoint）是否兼容？**

    APM Agent和其他产品Agent都不兼容。APM大多是基于ASM框架进行字节码插桩实现的，同时安装两个Agent相当于对您的代码插桩两次，而不同产品的插桩代码实现不同，代码冲突可能造成严重的性能问题，因此建议您不要同时安装多个Agent。


1.  **APM指标数据采样策略是什么？**

    指标数据周期性完整采集，默认采集周期为1分钟。


1.  **APM调用链数据采样策略是什么？**

    调用链数据默认采用智能采样策略，调用链采样率会根据URL的时延和错误数动态变化。会提高平均时延超过配置阈值的URL和发生过错误的URL采样率，提高慢请求和异常请求的调用链的采样率。整体采样率会根据当前JVM的CPU大小变化，CPU利用率越高，调用链采样率越低，对Javaagent的CPU消耗越少。

    调用链的采样方式和比率可以在该应用的监控项配置进行设置，并且对整个入口URL生效。

    在APM2.0控制台，选择“指标”，选择需要配置的应用后的![](figures/zh-cn_image_0000001087394320.png)，选择“监控项”页签，在对应列表中单击URL监控所在行的“编辑”，在弹出的“编辑【URL监控】监控配置”页面的“采样类型”进行设置，如下图所示。

    ![](figures/zh-cn_image_0000001193926947.png)

2.  **指标数据未采集上来，可能有哪些原因？**
    1.  如果刚接入Agent，可以稍微等待几分钟后，就能看到数据。
    2.  如果显示数据采集被停止，可能的原因有：
        -   实例级别停止，Agent管理中采集被停止。
        -   监控项级别停止，监控项状态列表某些监控项采集被人为停止。
        -   全局配置中字节码方式采集被停止。

    1.  如果长时间未采集到指标数据，可能的原因有：
        -   java9启动提示找不到sql.time类

            原因分析：java agent开发环境为jdk1.7,而java 9模块化后，sql包不会默认提供，需要应用引入模块。

            出现概率：有条件出现。

            规避措施：如果出现该问题，应用在module-info.java主动引入java.sql。

        -   java11提示找不到Caused by: java.lang.NoClassDefFoundError: sun/misc/Unsafe类

            原因分析：agent开发环境为jdk1.7,而java 11Unsafe类已经重新归到其他包下，需要使用兼容模式。

            出现概率：必然出现。

            规避措施：如果出现该问题，应用在module-info.java主动引入 jdk.unsupported。

        -   java9提示反射使用告警，后期针对java9以上版本会避免这个问题

            规避措施：设置illegal-access = warn （仅提示）或者删除该选项。




